<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diario de √Ånimo | Pinguino</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
    <style>
        /* Variables de Colores Pastel */
        :root {
            --color-principal: #FFD1DC; /* Rosa Pastel */
            --color-secundario: #B0E0E6; /* Menta Suave */
            --color-acento: #E6E6FA; /* Lila Claro */
            --color-base: #FAF0E6; /* Crema/Blanco */
            --color-texto: #333333;

            /* Colores para los Estados de √Ånimo */
            --mood-excelente: #7FFFD4; /* Aguamarina */
            --mood-bien: #98FB98; /* Verde Pastel */
            --mood-neutral: #FFFACD; /* Amarillo Suave */
            --mood-triste: #ADD8E6; /* Azul Claro */
            --mood-enojada: #FFB6C1; /* Rosa Coral */
        }

        body {
            font-family: 'Varela Round', sans-serif;
            background-color: var(--color-base);
            color: var(--color-texto);
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        .header {
            background-color: var(--color-principal);
            color: white;
            padding: 20px 0;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin: 0;
            font-size: 1.8em;
        }

        /* Contenedor principal del calendario */
        .calendar-container {
            background-color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-nav button {
            background-color: var(--color-secundario);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .calendar-nav button:hover {
            background-color: #9bd3da;
        }

        #calendar-display {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        /* Estilo para los nombres de los d√≠as de la semana */
        .day-name {
            font-weight: bold;
            padding: 10px 0;
            color: var(--color-secundario);
        }

        /* Estilo general para cada casilla del d√≠a */
        .calendar-day {
            padding: 15px 5px;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid var(--color-acento);
            transition: all 0.2s;
            position: relative;
            min-height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .calendar-day:not(.empty-day):hover {
            box-shadow: 0 0 10px rgba(255, 209, 220, 0.7);
            transform: scale(1.05);
        }

        .day-number {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 3px;
        }

        /* Estilos de colores de √°nimo */
        .mood-excelente { background-color: var(--mood-excelente); color: var(--color-texto); }
        .mood-bien { background-color: var(--mood-bien); color: var(--color-texto); }
        .mood-neutral { background-color: var(--mood-neutral); color: var(--color-texto); }
        .mood-triste { background-color: var(--mood-triste); color: white; }
        .mood-enojada { background-color: var(--mood-enojada); color: var(--color-texto); }

        .empty-day {
            background-color: var(--color-base);
            cursor: default;
            border: none;
        }

        /* Estilo para el Pop-up (Modal) */
        .modal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 20px;
            border: 4px solid var(--color-principal);
            width: 80%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--color-principal);
            text-decoration: none;
        }

        .mood-selector button {
            background-color: var(--color-acento);
            border: 1px solid var(--color-principal);
            padding: 10px 15px;
            margin: 5px;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .mood-selector button.selected {
            background-color: var(--color-principal);
            color: white;
            font-weight: bold;
        }

        .modal-content textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            margin-top: 15px;
            border: 2px solid var(--color-acento);
            border-radius: 8px;
            box-sizing: border-box;
            resize: vertical;
        }

        #save-mood-button {
            background-color: var(--color-secundario);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            margin-top: 15px;
            cursor: pointer;
            font-size: 1em;
        }

        #save-mood-button:hover {
            background-color: #9bd3da;
        }

        .back-link {
            display: block;
            margin-top: 20px;
            text-decoration: none;
            color: var(--color-secundario);
            font-weight: bold;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <a href="index.html" class="back-link">‚Üê Volver al inicio</a>

    <div class="header">
        <h1>üóìÔ∏è Mi Calendario de √Ånimo<img src=img/flor.jfif height=120px;></h1>
    </div>

    <div class="calendar-container">
        <div class="calendar-nav">
            <button id="prev-month">‚Üê Anterior</button>
            <h2 id="current-month-year"></h2>
            <button id="next-month">Siguiente ‚Üí</button>
        </div>

        <div id="calendar-display">
            <div class="day-name">Dom</div>
            <div class="day-name">Lun</div>
            <div class="day-name">Mar</div>
            <div class="day-name">Mi√©</div>
            <div class="day-name">Jue</div>
            <div class="day-name">Vie</div>
            <div class="day-name">S√°b</div>
            </div>
    </div>

    <div id="mood-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3 id="modal-date-title">Registrando √°nimo para:</h3>
            <p>¬øC√≥mo te sientes hoy?</p>
            
            <div class="mood-selector">
                <button data-mood="Excelente">üòÅ Excelente</button>
                <button data-mood="Bien">üòä Bien</button>
                <button data-mood="Neutral">üòê Neutral</button>
                <button data-mood="Triste">üò• Triste</button>
                <button data-mood="Enojada">üò† Enojada</button>
            </div>

            <textarea id="mood-note" placeholder="Escribe aqu√≠ una nota breve sobre por qu√© te sientes as√≠ (opcional)."></textarea>
            
            <button id="save-mood-button">Guardar √Ånimo</button>
            <p class="footer-note">¬øQuieres hablar con Parca Game sobre este d√≠a? Ve al chat despu√©s de guardar.</p>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURACI√ìN INICIAL ---
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        const calendarDisplay = document.getElementById('calendar-display');
        const monthYearTitle = document.getElementById('current-month-year');
        const moodModal = document.getElementById('mood-modal');
        const closeButton = document.querySelector('.close-button');
        const moodSelectorButtons = document.querySelectorAll('.mood-selector button');
        const saveButton = document.getElementById('save-mood-button');
        
        let selectedDate = null;
        let selectedMood = null;

        const MOOD_CLASSES = {
            "Excelente": "mood-excelente",
            "Bien": "mood-bien",
            "Neutral": "mood-neutral",
            "Triste": "mood-triste",
            "Enojada": "mood-enojada"
        };

        const MONTHS = [
            "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
            "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
        ];

        // --- 2. GESTI√ìN DE LOCAL STORAGE (Base de datos simple) ---

        // Carga los datos de estado de √°nimo del LocalStorage
        function loadMoodData() {
            try {
                return JSON.parse(localStorage.getItem('moodData')) || {};
            } catch (e) {
                console.error("Error al cargar datos de LocalStorage:", e);
                return {};
            }
        }

        // Guarda un nuevo estado de √°nimo
        function saveMood(dateKey, mood, note) {
            const data = loadMoodData();
            data[dateKey] = { mood: mood, note: note, timestamp: new Date().toISOString() };
            localStorage.setItem('moodData', JSON.stringify(data));
        }

        // --- 3. FUNCIONES DEL CALENDARIO ---

        function renderCalendar(month, year) {
            // Limpiar los d√≠as viejos (manteniendo los nombres de los d√≠as)
            let daysToRemove = calendarDisplay.querySelectorAll('.calendar-day');
            daysToRemove.forEach(day => day.remove());

            monthYearTitle.innerText = `${MONTHS[month]} ${year}`;

            // 1. Determinar el primer d√≠a del mes (0=Domingo, 1=Lunes...)
            const firstDay = new Date(year, month, 1);
            const startDayOfWeek = firstDay.getDay(); // El d√≠a de la semana del d√≠a 1
            const daysInMonth = new Date(year, month + 1, 0).getDate(); // √öltimo d√≠a del mes

            // Cargar los datos guardados
            const savedData = loadMoodData();

            // Rellenar d√≠as vac√≠os al inicio para alinear la semana
            for (let i = 0; i < startDayOfWeek; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.classList.add('calendar-day', 'empty-day');
                calendarDisplay.appendChild(emptyDiv);
            }

            // Generar los d√≠as del mes
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('calendar-day');

                // Formato de clave: YYYY-MM-DD
                const monthStr = String(month + 1).padStart(2, '0');
                const dayStr = String(day).padStart(2, '0');
                const dateKey = `${year}-${monthStr}-${dayStr}`;

                dayDiv.innerHTML = `<span class="day-number">${day}</span>`;
                dayDiv.dataset.date = dateKey; // Guardamos la fecha completa

                // Aplicar el estilo si hay un estado de √°nimo guardado
                if (savedData[dateKey]) {
                    const mood = savedData[dateKey].mood;
                    dayDiv.classList.add(MOOD_CLASSES[mood]);
                }

                // Evento para abrir el modal
                dayDiv.addEventListener('click', () => openMoodModal(dateKey));

                calendarDisplay.appendChild(dayDiv);
            }
        }

        // --- 4. FUNCIONES DEL MODAL (Pop-up) ---

        function openMoodModal(dateKey) {
            selectedDate = dateKey;
            const [year, month, day] = dateKey.split('-');
            
            // T√≠tulo
            document.getElementById('modal-date-title').innerText = `Registrando √°nimo para: ${day}/${month}/${year}`;
            
            // Cargar datos existentes si los hay
            const savedData = loadMoodData();
            const existingEntry = savedData[dateKey];
            
            // Resetear y precargar valores
            selectedMood = null;
            document.getElementById('mood-note').value = existingEntry ? existingEntry.note : '';
            
            moodSelectorButtons.forEach(btn => {
                btn.classList.remove('selected');
                if (existingEntry && btn.dataset.mood === existingEntry.mood) {
                    btn.classList.add('selected');
                    selectedMood = existingEntry.mood;
                }
            });
            
            moodModal.style.display = "block";
        }

        function closeModal() {
            moodModal.style.display = "none";
            selectedDate = null;
            selectedMood = null;
            renderCalendar(currentMonth, currentYear); // Re-renderizar el calendario para reflejar el cambio
        }

        // --- 5. EVENT LISTENERS ---

        // Navegaci√≥n de meses
        document.getElementById('prev-month').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar(currentMonth, currentYear);
        });

        document.getElementById('next-month').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar(currentMonth, currentYear);
        });

        // Selecci√≥n de estado de √°nimo en el modal
        moodSelectorButtons.forEach(button => {
            button.addEventListener('click', function() {
                moodSelectorButtons.forEach(btn => btn.classList.remove('selected'));
                this.classList.add('selected');
                selectedMood = this.dataset.mood;
            });
        });

        // Guardar el registro
        saveButton.addEventListener('click', () => {
            if (selectedDate && selectedMood) {
                const note = document.getElementById('mood-note').value.trim();
                saveMood(selectedDate, selectedMood, note);
                closeModal();
            } else {
                alert("Por favor, selecciona un estado de √°nimo.");
            }
        });

        // Cierre del modal
        closeButton.addEventListener('click', closeModal);
        window.addEventListener('click', (event) => {
            if (event.target === moodModal) {
                closeModal();
            }
        });

        // --- INICIALIZACI√ìN ---
        document.addEventListener('DOMContentLoaded', () => {
            renderCalendar(currentMonth, currentYear);
        });
    </script>
</body>
</html>